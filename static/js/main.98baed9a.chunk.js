(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{168:function(e,t,n){e.exports=n(333)},173:function(e,t,n){},330:function(e,t,n){},333:function(e,t,n){"use strict";n.r(t);var o=n(1),a=n.n(o),r=n(9),c=n.n(r),i=(n(173),n(116)),s=n.n(i),u=n(148),l=n(24),d=n(25),p=n(28),h=n(26),m=n(27),f=n(149),b=n.n(f),v=n(78),y=n(79),g=n(165),C=Object.entries({blue:["#1E88E5","#90CAF9"],brown:["#6D4C41","#D7CCC8"],gray:["#212121","#BDBDBD"],green:["#388E3C","#A5D6A7"],red:["#E53935","#EF9A9A"],orange:["#F4511E","#FFAB91"],purple:["#8E24AA","#E1BEE7"],yellow:["#FFD600","#FFF59D"]}).reduce(function(e,t){var n=Object(g.a)(t,2),o=n[0],a=n[1];return Object(y.a)(Object(v.a)({},o,function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return console.log("%c".concat(e,"%c").concat(t,"%c").concat(n),"background-color: ".concat(a[0],"; color: #fff; padding: 2px 4px; font-weight: bold;"),"background-color: ".concat(a[1],"; color: #000; padding: 2px 4px;"),""!==n?"background-color: ".concat(a[0],"; color: #fff; padding: 2px 4px; font-weight: bold;"):"")}),e)},{});function k(e,t,n){n||(n=window.location.href);var o,a=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(a.test(n))return"undefined"!==typeof t&&null!==t?n.replace(a,"$1"+e+"="+t+"$2$3"):(o=n.split("#"),n=o[0].replace(a,"$1$3").replace(/(&|\?)$/,""),"undefined"!==typeof o[1]&&null!==o[1]&&(n+="#"+o[1]),n);if("undefined"!==typeof t&&null!==t){var r=-1!==n.indexOf("?")?"&":"?";return o=n.split("#"),n=o[0]+r+e+"="+t,"undefined"!==typeof o[1]&&null!==o[1]&&(n+="#"+o[1]),n}return n}function w(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}var S=function(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t);var n=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);t.select(),document.execCommand("copy"),document.body.removeChild(t),n&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(n))},E=n(55),I=n(166),O=n(76),j=n(44);function T(){var e=Object(E.a)(["\n  margin-left: 8px !important;\n"]);return T=function(){return e},e}var P=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.children,n=Object(I.a)(e,["children"]);return a.a.createElement(O.a,Object.assign({style:{padding:"0 15px"}},n),a.a.createElement(x,null,t))}}]),t}(o.Component),x=Object(j.a)("span")(T()),R=n(336),F=n(340),M=n(339),A=n(338),N=(n(227),function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return a.a.createElement(A.a,Object.assign({title:this.props.title,onCancel:this.props.onClose,visible:this.props.visible},this.props),this.props.children)}}]),t}(o.Component)),z=n(115),D=R.a.Item,U=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={status:"input",error:!1},n.hideModal=function(){n.setState({visible:!1})},n.handleSubmit=function(e){e.preventDefault(),n.props.form.validateFields(function(e,t){var o=t.userName;e||(n.props.onSubmit(o),n.props.isClientInstance?n.props.onClose():n.setState({status:"link"}))})},n.copyToClipboard=function(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t);var n=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);t.select(),document.execCommand("copy"),document.body.removeChild(t),n&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(n)),F.a.success("Successful copied")},n.textInput=a.a.createRef(),n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"makeUrl",value:function(){return k("buddyshoppingId",this.props.sessionId)}},{key:"renderContent",value:function(){var e=this,t=this.props.form.getFieldDecorator;switch(this.state.status){case"input":return a.a.createElement(R.a,{onSubmit:this.handleSubmit,layout:"inline"},a.a.createElement(D,null,t("userName",{rules:[{required:!0,message:"Please input your username!"}]})(a.a.createElement(M.a,{size:"large",name:"userName",placeholder:"Your username"}))),a.a.createElement(D,null,a.a.createElement(O.a,{type:"primary",htmlType:"submit",size:"large"},"Submit")));case"link":var n=this.makeUrl();return a.a.createElement(R.a,{onSubmit:this.handleSubmit,layout:"inline"},a.a.createElement("h4",{className:"h4"},"\u0421\u043a\u043e\u043f\u0438\u0440\u0443\u0439 \u0438 \u0440\u0430\u0437\u0434\u0430\u0439 \u0434\u0440\u0443\u0437\u044c\u044f\u043c"),a.a.createElement(D,null,a.a.createElement(M.a,{disabled:!0,value:n,size:"large"})),a.a.createElement(D,null,a.a.createElement(O.a,{type:"primary",size:"large",onClick:function(){return e.copyToClipboard(n)},icon:"copy"},"Copy")));default:return null}}},{key:"renderFooter",value:function(){return a.a.createElement("button",{onClick:this.props.onClose,className:"btn btn-primary"},"Close")}},{key:"render",value:function(){return a.a.createElement(N,{visible:this.props.visible,onClose:this.props.onClose,title:"\u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u044c\u0442\u0435\u0441\u044c",footer:this.renderFooter()},a.a.createElement("div",{className:"fieldsets-batch fieldsets-batch--with-single-field"},this.renderContent()))}}]),t}(o.Component),B=R.a.create()(U),$=n(337),q=n(14),W=n(335),H=n(334),J={getTotal:function(){return new Promise(function(e,t){window.Ecwid.cart.calculateTotal(function(t){e(t.total)})})},clear:function(){window.Ecwid.Cart.clear()},addProduct:function(e){return new Promise(function(t){window.Ecwid.Cart.addProduct(Object(y.a)({},e,{callback:t}))})},addProductsFromCart:function(e){var t=this,n=e.map(function(e){e.content.items.map(function(e){t.addProduct({id:e.product.id,quantity:e.quantity})})});return Promise.all(n)},gotoCheckout:function(){window.Ecwid.Cart.gotoCheckout()}},L={allReadyToCheckout:function(e){return!!e&&e.every(function(e){return e.owner.isReadyToCheckout})}};function K(){var e=Object(E.a)(["\n  display: flex;\n  justify-content: space-between;\n  padding-right: 16px;\n"]);return K=function(){return e},e}var G=$.a.Panel,Q=function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Number("".concat(Math.round("".concat(e,"e").concat(t)),"e-").concat(t))}(e,2)},Y=[{title:"Name",dataIndex:"product.name",key:"product.name"},{title:"Price",dataIndex:"product.price",key:"product.price",width:100},{title:"Price",dataIndex:"quantity",key:"quantity",width:100}],_=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,c=new Array(r),i=0;i<r;i++)c[i]=arguments[i];return(n=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(c)))).state={visible:!1},n.renderFooter=function(e){var t=n.props,r=(t.name,t.isClientInstance),c=!r&&!L.allReadyToCheckout(e);return a.a.createElement(o.Fragment,null,a.a.createElement(P,{onClick:function(){S(k("buddyshoppingId",n.props.sessionId)),F.a.success("Successful copied")}},"Copy invite link"),a.a.createElement(P,{type:"default",onClick:function(){return n.props.onReadyToCheckout(!0,n.props.customerId)}},"Ready to checkout!"),!r&&a.a.createElement(P,{disabled:c,type:"primary",onClick:function(){return n.onReadyToCheckOut(e)}},"Go to checkout"))},n.renderPanelHeader=function(e,t,n){return a.a.createElement(V,null,a.a.createElement("span",null,a.a.createElement(q.a,{type:n?"smile":"meh",theme:"twoTone",twoToneColor:n?"#52c41a":""})," ",e),a.a.createElement("span",null,t))},n.renderContent=function(e){var t=n.props.name;return a.a.createElement(o.Fragment,null,a.a.createElement($.a,{defaultActiveKey:t},e.map(function(e){var t=e.owner,o=e.content;return Object(z.a)(o)?null:a.a.createElement(G,{header:n.renderPanelHeader(t.name,Q(n.totalPriceForItems(o.items)),t.isReadyToCheckout),key:t.name,styled:{padding:0}},a.a.createElement(W.a,{columns:Y,dataSource:o.items,pagination:!1,size:"small",rowKey:function(e){return e.name},sortedInfo:null}))})),a.a.createElement(H.a,null),"\u041f\u0440\u0438\u043c\u0435\u0440\u043d\u0430\u044f \u043e\u0431\u0449\u0430\u044f \u0441\u0443\u043c\u043c\u0430: ",Q(n.totalPrice(e)))},n.totalPriceForItems=function(e){return e?e.reduce(function(e,t){return e+t.product.price*t.quantity},0):0},n.showModal=function(){n.setState({visible:!0})},n.hideModal=function(){n.setState({visible:!1})},n.renderCart=function(e){var t=e.cart;if(t)return a.a.createElement(o.Fragment,null,a.a.createElement(P,{onClick:n.showModal,size:"large",type:"primary",ghost:!0},"Buddy Cart"),a.a.createElement(N,{visible:n.state.visible,onClose:n.hideModal,title:"\u0421\u043f\u0438\u0441\u043e\u043a \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u043d\u044b\u0445 \u043f\u043e\u043a\u0443\u043f\u043e\u043a",footer:n.renderFooter(t)},a.a.createElement("div",{className:"fieldsets-batch fieldsets-batch--with-single-field"},n.renderContent(t))))},n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"onReadyToCheckOut",value:function(e){this.hideModal(),J.clear(),J.addProductsFromCart(e)}},{key:"totalPrice",value:function(e){var t=this;return e?e.reduce(function(e,n){return e+t.totalPriceForItems(n.content.items)},0):0}},{key:"render",value:function(){return a.a.createElement(ce.Consumer,null,this.renderCart)}}]),t}(o.Component);_.defaultProps={cart:[]};var V=Object(j.a)("div")(K());n(330);function X(){var e=Object(E.a)(["\n  text-align: center;\n  padding-bottom: 10px !important;\n"]);return X=function(){return e},e}var Z=function(e){function t(){var e,n;Object(l.a)(this,t);for(var o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return(n=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(a)))).state={showModal:!1,name:null,uid:null},n.setName=function(e){n.connectionPromise.then(function(){n.setState({name:e}),n.props.startSession(e)})},n.showModal=function(){n.connectionPromise=n.props.connect(),n.setState({showModal:!0})},n.hideModal=function(){n.setState({showModal:!1})},n.onConnectEstablished=function(e){n.setState({connectEstablished:!0,uid:e})},n.onConnectError=function(){},n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.props.isClientInstance&&this.showModal()}},{key:"render",value:function(){var e=this.props.connectStatus;return a.a.createElement(ee,null,"authorized"!==e&&a.a.createElement(P,{onClick:this.showModal,type:"primary",size:"large",icon:"shopping-cart"},"Shop with friends"),"authorized"===e&&a.a.createElement(_,{name:this.state.name,customerId:this.props.customerId,onReadyToCheckout:this.props.onReadyToCheckout,isClientInstance:this.props.isClientInstance,sessionId:this.props.motherId}),a.a.createElement(B,{isClientInstance:this.props.isClientInstance,connectStatus:this.props.connectStatus,visible:this.state.showModal,onClose:this.hideModal,onSubmit:this.setName,sessionId:this.props.motherId}))}}]),t}(o.Component),ee=Object(j.a)("div")(X()),te=function(e){return"BuddyShopping".concat(":").concat(e)},ne=function(e){return sessionStorage.getItem(te(e))},oe=function(e,t){return sessionStorage.setItem(te(e),t),t},ae="wss://buddyshopping.now.sh",re=["a9c06a4168967c89b1a54ee802f6a507"],ce=a.a.createContext(2),ie=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).eventHandler=function(){var e=Object(u.a)(s.a.mark(function e(t){var o,a,r,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.data,e.next=3,JSON.parse(o);case 3:a=e.sent,r=a.event,c=a.payload,C.blue("event: ",r),console.log(c),e.t0=r,e.next="startSession"===e.t0?11:"joinSession"===e.t0?11:"multicartUpdate"===e.t0?15:18;break;case 11:return n.setSocketStatus("authorized"),n.setCustomerId(c.customerId),window.Ecwid.OnCartChanged.add(n.onCartInit(c.customerId)),e.abrupt("break",19);case 15:return n.setSocketStatus("authorized"),n.setState({cart:c.multicartContent}),e.abrupt("break",19);case 18:return e.abrupt("break",19);case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.establishConnect=function(){return C.blue("\u0423\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u044e \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435",n.connectUrl),n.setSocketStatus("connecting"),n.socket=new WebSocket(n.connectUrl,re),n.setupSocket(),new Promise(function(e,t){n.resolveConnectionPromise=e,n.rejectConnectionPromise=t})},n.startSession=function(e){n.sendToSocket({event:"startSession",payload:{customerName:e}}),C.blue("\u0421\u0442\u0430\u0440\u0442\u0443\u044e \u0441\u0435\u0441\u0441\u0438\u044e",n.connectUrl)},n.joinSession=function(e){n.sendToSocket({event:"joinSession",payload:{customerName:e}}),C.blue("\u041a\u043e\u043d\u043d\u0435\u043a\u0442 \u043a \u0441\u0435\u0441\u0441\u0438\u0438",n.connectUrl)},n.onMessage=function(e){n.eventHandler(e)},n.sendToSocket=function(e){C.yellow("sendToSocket",e.event),console.log(e.payload),n.socket.send(JSON.stringify(e))},n.onCartInit=function(e){return function(t){var o=n.state.cart;L.allReadyToCheckout(o)||(C.yellow("onCartInit"),n.sendToSocket({event:"updateCart",payload:{customerId:e,cartContent:t}}))}},n.onCartChange=function(e){C.yellow("onCartChange"),n.sendToSocket({event:"updateCart",payload:{customerId:n.state.customerId,cartContent:e}})},n.onReadyToCheckout=function(e){C.yellow("customerReadyToCheckout"),n.sendToSocket({event:"customerReadyToCheckout",payload:{customerId:n.state.customerId,customerReadyToCheckout:e}})},n.motherId=n.getMotherId(),n.isClientInstance=!!w("buddyshoppingId"),n.state={connectStatus:"offline",customerId:void 0,connectEstablished:!1,cart:null},n.connectUrl="".concat(ae,"/").concat(n.motherId),n.resolveConnectionPromise=Function.prototype,n.rejectConnectionPromise=Function.prototype,n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"getMotherId",value:function(){var e=w("buddyshoppingId")||ne("motherId");return e||oe("motherId",b()())}},{key:"setupSocket",value:function(){this.onOpenSocket(),this.onCloseSocket(),this.onCloseSocket()}},{key:"setSocketStatus",value:function(e){this.setState({connectStatus:e})}},{key:"setCustomerId",value:function(e){this.setState({customerId:e})}},{key:"onOpenSocket",value:function(){var e=this;this.socket.onopen=function(){C.green("\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u043e",e.connectUrl),e.resolveConnectionPromise(),e.setSocketStatus("connected")},this.socket.onmessage=this.onMessage}},{key:"onCloseSocket",value:function(){var e=this;this.socket.onclose=function(t){t.wasClean?C.blue("\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0437\u0430\u043a\u0440\u044b\u0442\u043e \u0447\u0438\u0441\u0442\u043e"):C.red("\u041e\u0431\u0440\u044b\u0432 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435"),C.brown("\u041a\u043e\u0434: "+t.code+" \u043f\u0440\u0438\u0447\u0438\u043d\u0430: "+t.reason),e.rejectConnectionPromise(t),e.setSocketStatus("disconnect")}}},{key:"onErrorSocket",value:function(){var e=this;this.socket.onerror=function(t){console.log(t.message),C.red("\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435",t.message),e.setSocketStatus("error")}}},{key:"render",value:function(){var e=this.state,t=(e.connectEstablished,e.cart),n=e.connectStatus;return a.a.createElement(ce.Provider,{value:{cart:t,authorized:"authorized"===n,addToCart:this.sendToSocket}},a.a.createElement(Z,{onReadyToCheckout:this.onReadyToCheckout,customerId:this.state.customerId,isClientInstance:this.isClientInstance,connectStatus:n,connect:this.establishConnect,motherId:this.motherId,startSession:this.isClientInstance?this.joinSession:this.startSession}))}}]),t}(o.Component),se=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ue(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}function le(e){if("PRODUCT"===e.type){var t=document.getElementById("buddy-shopping");if(!t)(t=document.createElement("div")).id="buddy-shopping",document.querySelector(".ecwid-productBrowser-backgroundedPanelInner").appendChild(t);c.a.render(a.a.createElement(ie,null),t)}}window.EcwidApp.init({app_id:"buddy-shopping-dev",autoloadedflag:!0,autoheight:!1}),window.Ecwid.OnAPILoaded.add(),window.Ecwid.OnPageLoaded.add(le),function(){if("serviceWorker"in navigator){if(new URL("/buddyshopping-frontend",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/buddyshopping-frontend","/service-worker.js");se?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):ue(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):ue(e)})}}()}},[[168,2,1]]]);
//# sourceMappingURL=main.98baed9a.chunk.js.map